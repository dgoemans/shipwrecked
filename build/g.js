var h=Math;h.e=h.random;h.r=h.floor;h.U=h.ceil;h.Cb=h.abs;h.o=h.sin;h.l=h.cos;h.Fc=h.tan;h.L="TEXTURE_CUBE_MAP";h.pb="TEXTURE_WRAP_S";h.qb="TEXTURE_WRAP_T";h.$="CLAMP_TO_EDGE";h.Va="TEXTURE_MIN_FILTER";h.Ua="TEXTURE_MAG_FILTER";h.za="LINEAR";h.kc="NEAREST";h.I="TEXTURE_2D";h.kb="UNSIGNED_BYTE";glMatrixArrayType="undefined"!=typeof Float32Array?Float32Array:"undefined"!=typeof WebGLFloatArray?WebGLFloatArray:Array;function l(a){var f=new glMatrixArrayType(3);a&&(f[0]=a[0],f[1]=a[1],f[2]=a[2]);return f}function r(a,f){f[0]=a[0];f[1]=a[1];f[2]=a[2]}function H(a,f,b){b&&a!=b?(b[0]=a[0]+f[0],b[1]=a[1]+f[1],b[2]=a[2]+f[2]):(a[0]+=f[0],a[1]+=f[1],a[2]+=f[2])}function K(a,f,b){if(!b||a==b)return a[0]-=f[0],a[1]-=f[1],a[2]-=f[2],a;b[0]=a[0]-f[0];b[1]=a[1]-f[1];b[2]=a[2]-f[2];return b}
function W(a,f,b){if(!b||a==b)return a[0]*=f,a[1]*=f,a[2]*=f,a;b[0]=a[0]*f;b[1]=a[1]*f;b[2]=a[2]*f;return b}function X(a,f){f||(f=a);var b=a[0],c=a[1],e=a[2],g=h.sqrt(b*b+c*c+e*e);g?1==g?(f[0]=b,f[1]=c,f[2]=e):(g=1/g,f[0]=b*g,f[1]=c*g,f[2]=e*g):(f[0]=0,f[1]=0,f[2]=0)}function aa(a,f,b){b||(b=a);var c=a[0],e=a[1];a=a[2];var g=f[0],d=f[1];f=f[2];b[0]=e*f-a*d;b[1]=a*g-c*f;b[2]=c*d-e*g;return b}function fa(a){var f=a[0],b=a[1];a=a[2];return f*f+b*b+a*a}function ga(a,f){var b=K(a,f,l());return fa(b)}
function ha(a,f){return a[0]*f[0]+a[1]*f[1]+a[2]*f[2]}function Y(){return new glMatrixArrayType(16)}function Z(a){a[0]=a[5]=a[10]=a[15]=1;a[1]=a[2]=a[3]=a[4]=a[6]=a[7]=a[8]=a[9]=a[11]=a[12]=a[13]=a[14]=0;return a}function ia(a,f,b){var c=f[0],e=f[1];f=f[2];b&&a!=b||(a[12]=a[0]*c+a[4]*e+a[8]*f+a[12],a[13]=a[1]*c+a[5]*e+a[9]*f+a[13],a[14]=a[2]*c+a[6]*e+a[10]*f+a[14],a[15]=a[3]*c+a[7]*e+a[11]*f+a[15])}
function ja(a,f,b){var c=f[0],e=f[1];f=f[2];b&&a!=b||(a[0]*=c,a[1]*=c,a[2]*=c,a[3]*=c,a[4]*=e,a[5]*=e,a[6]*=e,a[7]*=e,a[8]*=f,a[9]*=f,a[10]*=f,a[11]*=f)}
function ka(a,f,b,c){var e=b[0],g=b[1];b=b[2];var d=h.sqrt(e*e+g*g+b*b);if(d){1!=d&&(d=1/d,e*=d,g*=d,b*=d);var n=h.o(f),k=h.l(f),m=1-k;f=a[0];var d=a[1],p=a[2],w=a[3],B=a[4],q=a[5],s=a[6],u=a[7],t=a[8],x=a[9],z=a[10];a=a[11];var y=e*e*m+k,A=g*e*m+b*n,v=b*e*m-g*n,C=e*g*m-b*n,D=g*g*m+k,F=b*g*m+e*n,G=e*b*m+g*n,e=g*b*m-e*n,g=b*b*m+k;c[0]=f*y+B*A+t*v;c[1]=d*y+q*A+x*v;c[2]=p*y+s*A+z*v;c[3]=w*y+u*A+a*v;c[4]=f*C+B*D+t*F;c[5]=d*C+q*D+x*F;c[6]=p*C+s*D+z*F;c[7]=w*C+u*D+a*F;c[8]=f*G+B*e+t*g;c[9]=d*G+q*e+x*g;
c[10]=p*G+s*e+z*g;c[11]=w*G+u*e+a*g}}
function la(a,f,b,c){var e=a[0],g=a[1];a=a[2];var d=b[0],n=b[1],k=b[2];b=f[1];var m=f[2];if(e==f[0]&&g==b&&a==m)Z(c);else{var p,w,B,q;b=e-f[0];m=g-f[1];f=a-f[2];q=1/h.sqrt(b*b+m*m+f*f);b*=q;m*=q;f*=q;p=n*f-k*m;k=k*b-d*f;d=d*m-n*b;(q=h.sqrt(p*p+k*k+d*d))?(q=1/q,p*=q,k*=q,d*=q):d=k=p=0;n=m*d-f*k;w=f*p-b*d;B=b*k-m*p;(q=h.sqrt(n*n+w*w+B*B))?(q=1/q,n*=q,w*=q,B*=q):B=w=n=0;c[0]=p;c[1]=n;c[2]=b;c[3]=0;c[4]=k;c[5]=w;c[6]=m;c[7]=0;c[8]=d;c[9]=B;c[10]=f;c[11]=0;c[12]=-(p*e+k*g+d*a);c[13]=-(n*e+w*g+B*a);c[14]=
-(b*e+m*g+f*a);c[15]=1}};function ma(a){this.h=a;this.M=function(a,b,c){function e(a){return 43758.5453*h.o(a)%1}function g(a,b,d){return a+(b-a)*d}var d=l([h.r(a),h.r(b),h.r(c)]);a=l([a%1,b%1,c%1]);for(b=0;3>b;b++)a[b]=a[b]*a[b]*(3-2*a[b]);d=d[0]+57*d[1]+113*d[2];return g(g(g(e(d+0),e(d+1),a[0]),g(e(d+57),e(d+58),a[0]),a[1]),g(g(e(d+113),e(d+114),a[0]),g(e(d+170),e(d+171),a[0]),a[1]),a[2])};this.random=function(){return h.e()}};function na(a){var f=this;f.h=a;f.Ob=function(a,c,e){f.height=c;f.width=a;f.size=e||1;a=f.W(a,c,e,3.4,30,32,52,350,!0);f.Ic=a.k;return a};f.W=function(a,c,e,g,d,n,k,m,p){m=f.va(a,c,g,d,n,k,m);g=Array(f.Ra(a,c));d=Array(f.Ra(a,c));n=Array(f.Sb(a,c));for(var w=k=0,B=0;B<c;B++)for(var q=0;q<a;q++)p?(n[w++]=q%2,n[w++]=B%2):(n[w++]=q/(a-1),n[w++]=B/(c-1)),g[k++]=q/(a-1)*e,g[k++]=m?m[B][q]:0,g[k++]=B/(c-1)*e;for(e=0;e<c;++e)for(p=0;p<a;++p){k=f.v(p<a-1?p+1:p,e,a,c,g)-f.v(0<p?p-1:p,e,a,c,g);if(0==p||p==
a-1)k*=2;m=f.v(p,e<c-1?e+1:e,a,c,g)-f.v(p,0<e?e-1:e,a,c,g);if(0==e||e==c-1)m*=2;k=l([-k,2,m]);X(k);d[e*a*3+3*p]=k[0];d[e*a*3+3*p+1]=k[1];d[e*a*3+3*p+2]=k[2]}e=Array(f.Qb(a,c));for(p=k=0;p<c-1;p++)for(m=0;m<a-1;m++)e[k++]=p*a+m,e[k++]=p*a+m+1,e[k++]=(p+1)*a+m,e[k++]=p*a+m+1,e[k++]=(p+1)*a+m,e[k++]=(p+1)*a+m+1;return{k:g,P:d,A:e,u:n,dataType:$.TRIANGLES,width:a,height:c}};f.v=function(a,c,e,g,d){d=d||f.Ic;e=e||f.width;g=g||f.height;a=h.b(a,0,e-1);c=h.b(c,0,g-1);return d[3*a+3*e*c+1]};f.Rb=function(a,
c){var e=Array(4);e[0]=f.v(h.r(a),h.r(c));e[1]=f.v(h.r(a),h.U(c));e[2]=f.v(h.U(a),h.r(c));e[3]=f.v(h.U(a),h.U(c));var g=a%1,d=c%1;return(e[0]+(e[2]-e[0])*g+(e[1]+(e[3]-e[1])*g)+(e[0]+(e[1]-e[0])*d)+(e[2]+(e[3]-e[2])*d))/4};f.va=function(a,c,e,g,d,n,k){for(var m=Array(c),p=0;p<c;p++)m[p]=Array(a);m=f.qc(e,g,m,a,c);m=f.rc(d,n,m,a,c);m=f.zc(m,a,c);0!==k&&(m=f.Wb(m,k,a,c));return m};f.qc=function(a,c,e,g,d){for(var n=0;n<d;n++)for(var k=0;k<g;k++)e[n][k]=f.h.n.M(k/d*a,n/g*a,0)*c;return e};f.rc=function(a,
c,e,g,d){for(var n,k,m=Array(d),p=0;p<d;++p){m[p]=Array(g);for(var w=0;w<g;++w)n=p+h.r(f.h.n.random(a*p/d,a*w/g,0)*c),k=w+h.r(f.h.n.random(a*p/d,a*w/g,1)*c),0>n&&(n=0),n>=d&&(n=d-1),0>k&&(k=0),k>=g&&(k=g-1),m[p][w]=e[n][k]}return m};f.zc=function(a,c,f){for(var g=1;g<f-1;++g)for(var d=1;d<c-1;++d){for(var n=0,k=-1;1>=k;k++)for(var m=-1;1>=m;m++)n+=a[g+k][d+m];a[g][d]=n/9}return a};f.Wb=function(a,c,f,g){for(var d=0;d<g;++d)for(var n=0;n<f;++n)a[d][n]+=c*h.o(d/g*h.PI)*h.o(n/f*h.PI);return a};f.Ra=
function(a,f){return a*f*3};f.Sb=function(a,f){return a*f*2};f.Qb=function(a,f){return a*f+(a-1)*(f-2)}};function oa(a){this.h=a;this.Za=function(a,b,c){return this.ta(a,b,0,c,0,!0)};this.ta=function(a,b,c,e,g,d){a=[.5*-a,-b*e,c*(1-g),.5*a,-b*e,c*(1-g),.5*-a,b*(1-e),c*(1-g),.5*a,b*(1-e),c*(1-g),.5*-a,-b*e,-c*g,.5*a,-b*e,-c*g,.5*-a,b*(1-e),-c*g,.5*a,b*(1-e),-c*g,.5*-a,b*(1-e),-c*g,.5*a,b*(1-e),-c*g,.5*-a,b*(1-e),c*(1-g),.5*a,b*(1-e),c*(1-g),.5*-a,-b*e,-c*g,.5*a,-b*e,-c*g,.5*-a,-b*e,c*(1-g),.5*a,-b*e,c*(1-g),.5*a,-b*e,-c*g,.5*a,b*(1-e),-c*g,.5*a,-b*e,c*(1-g),.5*a,b*(1-e),c*(1-g),.5*-a,-b*e,-c*g,.5*-a,
b*(1-e),-c*g,.5*-a,-b*e,c*(1-g),.5*-a,b*(1-e),c*(1-g)];b=[];for(c=0;48>c;c+=8)b[c]=b[c+1]=b[c+3]=b[c+4]=0,b[c+2]=b[c+5]=b[c+6]=b[c+7]=1;c=[0,1,2,2,1,3,4,5,6,6,5,7,8,9,10,10,9,11,12,13,14,14,13,15,16,17,18,18,17,19,20,21,22,22,21,23];e=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0];d&&(a.length=e.length=12,c.length=6,b.length=8);return{k:a,P:e,A:c,u:b,dataType:$.TRIANGLES}};this.bb=function(a,
b,c){a=a||1;b=void 0!==b?b:.8;c=void 0!==c?c:.02;var e=1-b+b*h.e(),g=1-b+b*h.e(),d=1-b+b*h.e();b=[];for(var n=[],k=[],m=0;16>=m;m++)for(var p=m*h.PI/16,w=h.o(p),B=h.l(p),p=0;16>=p;p++){var q=2*p*h.PI/16,s=h.o(q),q=h.l(q)*w*e,u=B*g,s=s*w*d,t=1-p/16,x=1-m/16;n.push(q);n.push(u);n.push(s);k.push(t);k.push(x);var z=m%16,y=p%16;0===z&&(y=0);t=a+a*this.h.n.M(z,y,0)*c;x=a+a*this.h.n.M(z,y,1)*c;z=a+a*this.h.n.M(z,y,2)*c;b.push(t*q);b.push(x*u);b.push(z*s)}a=[];for(m=0;16>m;m++)for(p=0;16>p;p++)c=17*m+p,e=
c+16+1,a.push(c),a.push(e),a.push(c+1),a.push(e),a.push(e+1),a.push(c+1);return{k:b,P:n,u:k,A:a,dataType:$.TRIANGLES}}};function pa(a){this.h=a;this.ba=function(a,b,c,e,g){c=c||180;e=e||75;a=a||1;b=b||this.h.n.random;g=g||256;var d=this.sa(g,function(d,k){var m=h.Cb(b(d/g*25,k/g*25,0)*a),m=h.b(m,0,1);return[c+e*m,c+e*m,c+e*m,255]}),d=this.oc(d,g),d=new Uint8Array(d);return this.data(d,g,g)};this.Fb=function(){var a,b,c,e;a=a||255;b=b||255;c=c||255;e=e||0;var g=this.h.H.va(128,128,20,1,32,52,0),d=this.sa(128,function(d,k){var m=g[k][d],m=2*m*m*h.o(d/128*h.PI)*h.o(k/128*h.PI),m=h.b(m,0,1);return[a+(255-a)*m,b+(255-b)*
m,c+(255-c)*m,e+(255-e)*m]}),d=new Uint8Array(d);return this.data(d,128,128)};this.sa=function(a,b){for(var c=Array(4*a*a),e=0,g=0;g<a;g++)for(var d=0;d<a;d++)for(var n=b(d,g),k=0;k<n.length;k++)c[e++]=n[k];return c};this.K=function(a,b,c){a=new Uint8Array([a,b,c,a,b,c,a,b,c,a,b,c]);return this.data(a,2,2,$.RGB)};this.Na=function(a,b,c){var e=$.RGBA,g,d,n,k,m,p,w=this.h.H.va(256,256,5,1,32,52,0),B=this.sa(256,function(d,k){var e=w[k][d],e=h.b(e,0,1);return[a+(255-a)*e,b+(255-b)*e,c+(255-c)*e,255+
0*e]});g=d=n=k=m=p=new Uint8Array(B);B=$.createTexture();$.bindTexture($[h.L],B);$.texParameteri($[h.L],$[h.pb],$[h.$]);$.texParameteri($[h.L],$[h.qb],$[h.$]);$.texParameteri($[h.L],$[h.Va],$[h.za]);$.texParameteri($[h.L],$[h.Ua],$[h.za]);g=[[g,$.TEXTURE_CUBE_MAP_POSITIVE_X],[d,$.TEXTURE_CUBE_MAP_NEGATIVE_X],[n,$.TEXTURE_CUBE_MAP_POSITIVE_Y],[k,$.TEXTURE_CUBE_MAP_NEGATIVE_Y],[m,$.TEXTURE_CUBE_MAP_POSITIVE_Z],[p,$.TEXTURE_CUBE_MAP_NEGATIVE_Z]];for(d=0;d<g.length;d++)n=g[d][1],k=g[d][0],$.bindTexture($[h.L],
B),$.pixelStorei($.UNPACK_ALIGNMENT,1),$.texImage2D(n,0,e,256,256,0,e,$[h.kb],k);return B};this.data=function(a,b,c,e,g){e=e||$.RGBA;var d=$.createTexture();$.bindTexture($[h.I],d);$.texParameteri($[h.I],$[h.pb],g?$[h.$]:$.REPEAT);$.texParameteri($[h.I],$[h.qb],g?$[h.$]:$.REPEAT);$.texParameteri($[h.I],$[h.Va],$[h.kc]);$.texParameteri($[h.I],$[h.Ua],$[h.za]);$.pixelStorei($.UNPACK_ALIGNMENT,1);$.texImage2D($[h.I],0,e,b,c,0,e,$[h.kb],a);return d};this.B=function(a){return(a[0]+a[1]+a[2])/3/255};this.b=
function(a,b){return a>b?b:0>a?0:a};this.Aa=function(a){return 127.5*(a+1)};this.w=function(a,b,c,e){return[a[c*e*4+4*b],a[c*e*4+4*b+1],a[c*e*4+4*b+2]]};this.oc=function(a,b){var c;c=c||2;for(var e=Array(a.length),g=0;g<b;++g)for(var d=0;d<b;++d){var n=this.w(a,this.b(g-1,b),this.b(d-1,b),b),k=this.w(a,this.b(g-1,b),this.b(d,b),b),m=this.w(a,this.b(g-1,b),this.b(d+1,b),b),p=this.w(a,this.b(g,b),this.b(d+1,b),b),w=this.w(a,this.b(g+1,b),this.b(d+1,b),b),B=this.w(a,this.b(g+1,b),this.b(d,b),b),q=this.w(a,
this.b(g+1,b),this.b(d-1,b),b),s=this.w(a,this.b(g,b),this.b(d-1,b),b),n=this.B(n),m=this.B(m),w=this.B(w),q=this.B(q),k=l([m+2*this.B(p)+w-(n+2*this.B(s)+q),q+2*this.B(B)+w-(n+2*this.B(k)+m),1/c]);X(k);e[g*b*4+4*d]=this.Aa(k[0]);e[g*b*4+4*d+1]=this.Aa(k[1]);e[g*b*4+4*d+2]=this.Aa(k[2]);e[g*b*4+4*d+3]=255}return e}};var qa={};
function ra(a,f,b,c,e,g){var d=this;d.h=a;d.dataType=f.dataType;d.rb=!0;d.$a=!0;d.offset=l();d.position=l();d.scale=l([1,1,1]);d.J=l([1,1,1]);d.Y=l();d.F=0;d.D=!1;d.aa={};d.c=l();d.parent=null;d.l=[];d.qa=!1;d.type=0;d.ca=0;d.Oa=!1;d.Jc=c;d.mc=e;d.tc=g;d.$b=b;d.time=0;d.ua=l();d.fb=0;d.fa=l();d.createBuffer=function(a,d){var b=$.createBuffer(),e=$.ARRAY_BUFFER;$.bindBuffer(e,b);$.bufferData(e,new Float32Array(a),$.STATIC_DRAW);b.Ta=d;b.Xa=a.length;return b};d.Ub=function(a){d.Nc=d.createBuffer(a.k,3);
d.lc=d.createBuffer(a.P,3);d.Gc=d.createBuffer(a.Hc,4);d.Mc=d.createBuffer(a.u,2);d.X=$.createBuffer();var b=$.ELEMENT_ARRAY_BUFFER;$.bindBuffer(b,d.X);$.bufferData(b,new Uint16Array(a.A),$.STATIC_DRAW);d.X.Ta=1;d.X.Xa=a.A.length};d.Qa=function(a,d,b){var e=new XMLHttpRequest,c="";e.open("GET","s"+d,!1);e.send();c=e.responseText;c=c.replace(/@/g,"attribute").replace(/\u20ac/g,"uniform").replace(/\$/g,"varying").replace(/v2/g,"vec2").replace(/v3/g,"vec3").replace(/v4/g,"vec4");d=$.createShader(b);
$.shaderSource(d,"#define "+a+"\n"+c);$.compileShader(d);return d};d.Gb=function(a){if(qa[a])return qa[a];var b=null,e=d.Qa(a,".ps",$.FRAGMENT_SHADER),c=d.Qa("shaders.min",".vs",$.VERTEX_SHADER),b=$.createProgram();$.attachShader(b,c);$.attachShader(b,e);$.linkProgram(b);if(e=$.getProgramParameter(b,$.LINK_STATUS))return $.useProgram(b),b.Ja=$.getAttribLocation(b,"aV"),b.Ia=$.getAttribLocation(b,"aVN"),b.Ha=$.getAttribLocation(b,"aTex"),b.Ka=$.getAttribLocation(b,"aVTn"),b.pc=$.getUniformLocation(b,
"uP"),b.ic=$.getUniformLocation(b,"uMV"),b.jc=$.getUniformLocation(b,"uN"),b.cc=$.getUniformLocation(b,"uM"),b.Kc=$.getUniformLocation(b,"sD"),b.nc=$.getUniformLocation(b,"sN"),b.sc=$.getUniformLocation(b,"sR"),b.Db=$.getUniformLocation(b,"uA"),b.Yb=$.getUniformLocation(b,"uL"),b.Jb=$.getUniformLocation(b,"uD"),b.Lc=$.getUniformLocation(b,"uT"),b.Nb=$.getUniformLocation(b,"uE"),b.wc=$.getUniformLocation(b,"uS"),qa[a]=b;console.error("Could not initialise shaders: "+e)};d.Mb=function(a){$.enableVertexAttribArray(a.Ja);
$.enableVertexAttribArray(a.Ia);$.enableVertexAttribArray(a.Ha);$.enableVertexAttribArray(a.Ka)};d.Kb=function(a){$.disableVertexAttribArray(a.Ja);$.disableVertexAttribArray(a.Ia);$.disableVertexAttribArray(a.Ha);$.disableVertexAttribArray(a.Ka)};d.gb=function(a){"number"===typeof a?r([a,a,a],d.scale):r(a,d.scale)};d.update=function(a){d.time=d.h.elapsedTime;d.ua=d.h.g;if(d.parent)r(d.parent.position,d.position),r(d.parent.Y,d.Y),d.F=d.parent.F;else if(d.D){var b=l();W(d.c,a,b);H(d.position,b,d.position);
a=d.h.da(d.position[0],d.position[2]);d.position[1]<a+d.aa.Ea&&(d.position[1]=a+d.aa.Ea,r([0,0,0],d.c));d.c[1]+=-9.8}d.Oa&&(a=l(),K(d.ua,d.position,a),d.ca=4E4-h.sqrt(fa(a)))};d.Pa=function(a,b,e){var c=d.yc;$.useProgram(c);d.Mb(c);$.activeTexture($.TEXTURE0);$.bindTexture($.TEXTURE_2D,d.Jc);$.uniform1i(c.Kc,0);$.activeTexture($.TEXTURE1);$.bindTexture($.TEXTURE_2D,d.mc);$.uniform1i(c.nc,1);$.activeTexture($.TEXTURE2);$.bindTexture($.TEXTURE_CUBE_MAP,d.tc);$.uniform1i(c.sc,2);$.uniform3fv(c.Db,d.J);
$.uniform1f(c.Lc,d.time);$.uniform1f(c.wc,d.fb);$.uniform3fv(c.Nb,d.ua);var g=l();X(d.fa,g);W(g,-1);$.uniform3fv(c.Yb,g);$.uniform3f(c.Jb,.6,.6,.6);d.xc(a,b,e,c);d.Eb=$.ARRAY_BUFFER;d.la(d.Nc,c.Ja);d.la(d.lc,c.Ia);d.la(d.Gc,c.Ka);d.la(d.Mc,c.Ha);$.depthMask(d.rb);d.$a?$.enable($.DEPTH_TEST):$.disable($.DEPTH_TEST);$.bindBuffer($.ELEMENT_ARRAY_BUFFER,d.X);$.drawElements(d.dataType,d.X.Xa,$.UNSIGNED_SHORT,0);d.Kb(c)};d.la=function(a,b){$.bindBuffer(d.Eb,a);$.vertexAttribPointer(b,a.Ta,$.FLOAT,!1,0,
0)};d.xc=function(a,b,c,e){if(d.qa){Z(b);var g=c[0],f=c[1],q=c[2],s=c[3],u=c[4],t=c[5],x=c[6],z=c[7],y=c[8],A=c[9],v=c[10],C=c[11],D=c[12],F=c[13],G=c[14],J=c[15],I=g*t-f*u,L=g*x-q*u,M=g*z-s*u,N=f*x-q*t,O=f*z-s*t,P=q*z-s*x,Q=y*F-A*D,R=y*G-v*D,S=y*J-C*D,T=A*G-v*F,U=A*J-C*F,V=v*J-C*G,E=1/(I*V-L*U+M*T+N*S-O*R+P*Q);b[0]=(t*V-x*U+z*T)*E;b[1]=(-f*V+q*U-s*T)*E;b[2]=(F*P-G*O+J*N)*E;b[3]=(-A*P+v*O-C*N)*E;b[4]=(-u*V+x*S-z*R)*E;b[5]=(g*V-q*S+s*R)*E;b[6]=(-D*P+G*M-J*L)*E;b[7]=(y*P-v*M+C*L)*E;b[8]=(u*U-t*S+z*
Q)*E;b[9]=(-g*U+f*S-s*Q)*E;b[10]=(D*O-F*M+J*I)*E;b[11]=(-y*O+A*M-C*I)*E;b[12]=(-u*T+t*R-x*Q)*E;b[13]=(g*T-f*R+q*Q)*E;b[14]=(-D*N+F*L-G*I)*E;b[15]=(y*N-A*L+v*I)*E;b[0]=b[0];b[1]=b[1];b[2]=b[2];b[3]=b[3];b[4]=b[4];b[5]=b[5];b[6]=b[6];b[7]=b[7];b[8]=b[8];b[9]=b[9];b[10]=b[10];b[11]=b[11];b[12]=0;b[13]=0;b[14]=0;b[15]=1;ja(b,d.scale,b);b[12]=d.position[0];b[13]=d.position[1];b[14]=d.position[2]}else ia(b,d.position,b),ka(b,d.F,d.Y,b),ja(b,d.scale,b),g=l(),K(g,d.offset,g),ia(b,g,b);(f=g=Y())||(f=c);q=
c[0];s=c[1];u=c[2];t=c[3];x=c[4];z=c[5];y=c[6];A=c[7];v=c[8];C=c[9];D=c[10];F=c[11];G=c[12];J=c[13];I=c[14];c=c[15];var L=b[0],M=b[1],N=b[2],O=b[3],P=b[4],Q=b[5],R=b[6],S=b[7],T=b[8],U=b[9],V=b[10],E=b[11],ba=b[12],ca=b[13],da=b[14],ea=b[15];f[0]=L*q+M*x+N*v+O*G;f[1]=L*s+M*z+N*C+O*J;f[2]=L*u+M*y+N*D+O*I;f[3]=L*t+M*A+N*F+O*c;f[4]=P*q+Q*x+R*v+S*G;f[5]=P*s+Q*z+R*C+S*J;f[6]=P*u+Q*y+R*D+S*I;f[7]=P*t+Q*A+R*F+S*c;f[8]=T*q+U*x+V*v+E*G;f[9]=T*s+U*z+V*C+E*J;f[10]=T*u+U*y+V*D+E*I;f[11]=T*t+U*A+V*F+E*c;f[12]=
ba*q+ca*x+da*v+ea*G;f[13]=ba*s+ca*z+da*C+ea*J;f[14]=ba*u+ca*y+da*D+ea*I;f[15]=ba*t+ca*A+da*F+ea*c;$.uniformMatrix4fv(e.pc,!1,a);$.uniformMatrix4fv(e.ic,!1,g);$.uniformMatrix4fv(e.cc,!1,b);a=new glMatrixArrayType(9);b=g[0];c=g[1];f=g[2];q=g[4];s=g[5];u=g[6];t=g[8];x=g[9];g=g[10];z=g*s-u*x;y=-g*q+u*t;A=x*q-s*t;if(v=b*z+c*y+f*A)v=1/v,a[0]=z*v,a[1]=(-g*c+f*x)*v,a[2]=(u*c-f*s)*v,a[3]=y*v,a[4]=(g*b-f*t)*v,a[5]=(-u*b+f*q)*v,a[6]=A*v,a[7]=(-x*b+c*t)*v,a[8]=(s*b-c*q)*v;a&&a!=a||(b=a[1],c=a[2],g=a[5],a[1]=
a[3],a[2]=a[6],a[3]=b,a[5]=a[7],a[6]=c,a[7]=g);$.uniformMatrix3fv(e.jc,!1,a)};d.Fa=function(a){a?a.l.push(this):d.parent.l.removeItem(this);d.parent=a};d.Pb=function(a){for(var b=a.A.length,c=a.k.length,d=Array(c),e=Array(c),g=Array(h.U(c+c/3)),f=0;f<b;f+=3){var s=a.A[f+0],u=a.A[f+1],t=a.A[f+2],x=[a.k[3*s],a.k[3*s+1],a.k[3*s+2]],z=[a.k[3*u],a.k[3*u+1],a.k[3*u+2]],y=[a.k[3*t],a.k[3*t+1],a.k[3*t+2]],A=[a.u[2*s],a.u[2*s+1]],v=[a.u[2*u],a.u[2*u+1]],C=[a.u[2*t],a.u[2*t+1]],D=z[0]-x[0],F=y[0]-x[0],G=z[1]-
x[1],J=y[1]-x[1],z=z[2]-x[2],x=y[2]-x[2],y=v[0]-A[0],I=C[0]-A[0],v=v[1]-A[1],C=C[1]-A[1],A=1/(y*C-I*v),C=l([(C*D-v*F)*A,(C*G-v*J)*A,(C*z-v*x)*A]),D=l([(y*F-I*D)*A,(y*J-I*G)*A,(y*x-I*z)*A]);d[s]||(d[s]=l());d[u]||(d[u]=l());d[t]||(d[t]=l());e[s]||(e[s]=l());e[u]||(e[u]=l());e[t]||(e[t]=l());H(d[s],C);H(d[u],C);H(d[t],C);H(e[s],D);H(e[u],D);H(e[t],D)}for(f=b=0;f<c/3;f++)s=l([a.P[3*f],a.P[3*f+1],a.P[3*f+2]]),u=d[f],t=l(),X(K(u,W(s,ha(s,u))),t),g[b++]=t[0],g[b++]=t[1],g[b++]=t[2],g[b++]=0>ha(aa(s,u),
e[f])?-1:1;a.Hc=g};d.Pb(f);d.Ub(f);d.yc=d.Gb(d.$b)};window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;h.b=function(a,f,b){return h.max(h.min(a,b),f)};Array.prototype.removeItem=function(a){var f=this.indexOf(a);-1<f&&this.splice(f,1);return a};var $;
function sa(){var a=this;a.ha=Y();a.ia=Y();a.Ga=256;a.jb=256;a.scale=40*a.Ga;a.ra=Y();a.na=l([0,1,0]);a.ja=70;a.g=l([-4E3,0,-4E3]);a.m=l([0,0,0]);a.Oc=250;a.Pc=10;a.fa=l([.05,-1,.05]);a.ga=1;a.q=1E3;a.ob=5;a.then=Date.now();a.elapsedTime=0;a.Sa=!1;a.wa=!1;a.c=l();a.xa=0;a.ya=0;a.Rc=!1;a.Q=0;a.s=[];a.Ya=.8;a.t=0;a.state=0;a.ea=!1;a.N=null;a.d=[];a.ma=[];a.n=new ma(this);a.H=new na(this);a.j=new pa(this);a.O=new oa(this);a.a=new ta;a.Ac=function(a,c){return a.ca-c.ca};a.Lb=function(){$.clearColor(.6,
.95,1,1);$.enable($.BLEND);$.blendFunc($.SRC_ALPHA,$.ONE_MINUS_SRC_ALPHA);$.viewport(0,0,$.mb,$.lb);$.clear($.COLOR_BUFFER_BIT|$.DEPTH_BUFFER_BIT);var b=a.ia,c=$.mb/$.lb,e=10*h.Fc(30*h.PI/360),c=e*c,g=-c,d=-e;b||(b=Y());var f=c-g,k=e-d;b[0]=20/f;b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=20/k;b[6]=0;b[7]=0;b[8]=(c+g)/f;b[9]=(e+d)/k;b[10]=-40010/39990;b[11]=-1;b[12]=0;b[13]=0;b[14]=-8E5/39990;b[15]=0;$.bindFramebuffer($.FRAMEBUFFER,a.G);$.clear($.COLOR_BUFFER_BIT|$.DEPTH_BUFFER_BIT);for(e=0;e<a.d.length;e++)Z(a.ha),
a.d[e].Pa(a.ia,a.ha,a.ra);$.bindFramebuffer($.FRAMEBUFFER,null);(e=a.ia)||(e=Y());e[0]=2;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=2;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=-2/99.9;e[11]=0;e[12]=-0;e[13]=-0;e[14]=-100.1/99.9;e[15]=1;Z(a.ha);a.ab.Pa(a.ia,a.ha,Z(Y()))};a.update=function(){var b=Date.now(),c=h.min(1E3,b-a.then),e=c/1E3;a.elapsedTime+=e;var c=l(),g=l();K(a.m,a.g,c);X(c);aa(c,a.na,g);X(g);var d=0,f=0;a.a.T(a.a.Ab)?a.ga=!a.ga:a.a.T(a.a.zb)&&!a.wa?(a.wa=!0,a.c[1]=150):a.a.T(a.a.wb);if(a.ea){if(a.a.C(a.a.Bb)||
a.a.C(a.a.oa))d+=1;if(a.a.C(a.a.ub)||a.a.C(a.a.sb))d-=1;if(a.a.C(a.a.vb)||a.a.C(a.a.yb))f-=1;if(a.a.C(a.a.xb)||a.a.C(a.a.tb))f+=1}if(a.t){a.Q+=e;var k=a.s[0].time,m=k+a.Ya<a.Q;if(a.Q<k||m)m&&(a.f(),a.s.shift());else if(a.p?a.f("Tap with 2 fingers"):a.f("Press: "+String.fromCharCode(a.s[0].key)),a.a.T(a.s[0].key))a.f(),a.Da(),a.s.shift(),a.t--;else if(a.a.T(a.a.La)||a.a.T(a.a.E))a.f(),a.s.shift();0===a.s.length&&0<a.t&&a.Z(k+a.Ya,a.t)}k=a.g[1]<a.ja/2;m=(k&&a.ga&&!a.t?a.Pc:a.Oc)*e;f*=m;W(c,d*m);W(g,
f);d=l();W(a.c,e,d);H(c,d,c);a.c[1]-=9.8;a.c[0]*=.98;a.c[2]*=.98;H(c,g);H(a.g,c);H(a.m,c);c=a.da(a.g[0],a.g[2]);a.ga?(c=c+a.ja-a.g[1],0<c&&(a.wa=!1,a.c[1]=0,a.g[1]+=c,a.m[1]+=c)):a.c[1]=0;Z(a.ra);la(a.g,a.m,a.na,a.ra);c=K(a.m,a.g,l());W(c,50);H(c,a.g,a.i.position);for(c=0;c<a.d.length;c++)g=a.d[c],g.D&&0>g.position[1]||g.Hb?(a.Ib(g),a.d.removeItem(g),c--):(g.fa=a.fa,g.update(e));a.d.sort(a.Ac);a.Lb();switch(a.state){case 0:a.ob=5*(h.o(a.elapsedTime)+1)+5;k||(r([0,0,0],a.c),a.ja=70,a.s=[],a.t=0,a.ea=
!0,a.state=1,a.gc());break;case 2:a.t||(a.f("Quick, blow on the fire to keep it going!"),a.state=3,a.Q=0,a.Z(1.5,10),a.Da=function(){var b=a.N.scale[1];a.N.gb(b+5)});break;case 3:a.t||(a.f("Whew. Hopefully this will get some attention. Time to get some rest",a.q,a.hc),a.state=4)}a.then=b};a.da=function(b,c){var e=a.H.Rb((b-a.S.position[0])/a.scale*a.Ga,(c-a.S.position[2])/a.scale*a.jb)+a.S.position[1];return h.max(e,-a.ja+a.ob)};a.Ib=function(b){for(var c=0;c<b.l.length;c++)a.d.removeItem(b.l[c]);
a.d.removeItem(b)};a.hb=function(b,c){var e=new ra(this,a.O.Za(c,c,.2),"fire",null);e.Fa(b);e.qa=!0;e.Oa=!0;e.fb=46547*h.e();a.d.push(e);return e};a.ib=function(b,c,e){e=e||a.da(b,c);b=a.R(a.O.bb(5,.2,.05),[b,e,c],[0,1,0],h.e()*h.PI*2,"bumpmap",a.bc,a.ac);r([.5,.5,.5],b.J);b.aa.Ea=5;b.D=!0;b.type=1;return b};a.Bc=function(){var b=a.ib(7400,7400,1600);b.D=!1;b.type=3;var c=a.hb(b,200);b.l.push(c);a.ma.push(b);setTimeout(function(){b.type=1;c.Hb=!0},3E4)};a.f=function(b,c,e){function g(a){d.style.display=
a?"block":"none"}var d=document.getElementById("hud");g(1);if(b)if(c){var f=c/1E3,k=b.replace("{0}",f);d.innerHTML=k;var m=setInterval(function(){k=b.replace("{0}",f);d.innerHTML=k;f--;0>f&&(g(0),clearInterval(m),e&&e.call(a))},1E3)}else d.innerHTML=b;else g(0)};a.Cc=function(){var b=-2500+5E3*h.e(),c=-2500+5E3*h.e(),e=a.da(b,c),b=a.R(a.O.ta(40+10*h.e(),1,2+5*h.e(),.5,.5),[b,e,c],[0,1,0],h.e()*h.PI,"bumpmap",a.j.K(236,217,153),a.ka);r([.62,.54,.29],b.J);b.D=!0;b.aa.Ea=3;b.type=2};a.R=function(b,c,
e,g,d,f,k,m){b=new ra(this,b,d,f,k,m);r(c,b.position);r(e,b.Y);b.F=g;a.d.push(b);return b};a.Z=function(b,c){a.t=c;var e=a.p?a.a.dc:.5>h.e()?a.a.E:a.a.La;a.s.push({key:e,time:b})};a.Vb=function(){function b(a){document.pointerLockElement||document.mozPointerLockElement||document.webkitPointerLockElement||k.p?k.p&&a.touches?(k.xa=a.touches[0].pageX,k.ya=a.touches[0].pageY,1<a.touches.length&&k.a.Ba({keyCode:-1})):k.Ma||k.action(a):k.Zb()}function c(a){k.p&&a.touches&&0<a.touches.length&&k.a.Ca({keyCode:-1})}
function e(a){var b=document.pointerLockElement||document.mozPointerLockElement||document.webkitPointerLockElement,c=a.movementX||a.mozMovementX||a.webkitMovementX||0,d=a.movementY||a.mozMovementY||a.webkitMovementY||0;if(b!==document.body){var e=0,f=0;k.Wa&&(b=a.pageX||a.touches[0].pageX,a=a.pageY||a.touches[0].pageY,e=b-k.xa,f=a-k.ya,k.xa=b,k.ya=a)}else b&&(e=c,f=d),e=h.b(e,-100,100),f=h.b(f,-100,100);k.ea&&k.vc(e,f)}var g=/Mobile|Android|BlackBerry/;a.p=g.test(navigator.userAgent);g=/Trident/;
a.Tb=g.test(navigator.userAgent);a.Wa=a.p||a.Tb;var d=document.getElementById("glcanvas");d.width=window.innerWidth*(this.p?.6:.7);d.height=d.width/window.innerWidth*window.innerHeight;$=d.getContext("webgl")||d.getContext("experimental-webgl");var g=$.FRAMEBUFFER,f=$.RENDERBUFFER;$.mb=d.width;$.lb=d.height;a.G=$.createFramebuffer();$.bindFramebuffer(g,a.G);d=document.getElementById("glcanvas");a.G.width=d.width;a.G.height=d.height;a.eb=a.j.data(null,a.G.width,a.G.height,$.RGBA,!0);d=$.createRenderbuffer();
$.bindRenderbuffer(f,d);$.renderbufferStorage(f,$.DEPTH_COMPONENT16,a.G.width,a.G.height);$.framebufferTexture2D(g,$.COLOR_ATTACHMENT0,$[h.I],a.eb,0);$.framebufferRenderbuffer(g,$.DEPTH_ATTACHMENT,f,d);$.bindTexture($[h.I],null);$.bindRenderbuffer(f,null);$.bindFramebuffer(g,null);a.ac=a.j.ba(1,a.n.M,130,125);a.bc=a.j.K(119,115,91);a.ka=a.j.ba(2,a.n.random,180,75,128);d=a.j.K(10,100,120);g=a.j.K(255,207,129);a.S=new ra(this,a.H.Ob(a.Ga,a.jb,a.scale),"bumpmap",g,a.ka);a.S.J=l([1,.8,.52]);r([-a.scale/
2,-200,-a.scale/2],a.S.position);a.d.push(a.S);f=3E4;a.R(a.H.W(2,2,f,0,0,0,0,0),[-f/2,0,-f/2],[1,0,0],0,"water",d,a.j.ba(1,a.n.random,130,125),a.j.Na(20,120,150));f=6E4;a.R(a.H.W(20,20,f,0,0,0,0,10500),[-f/2,-1E3,-f/2],[0,0,0],0,"unlit",a.j.Fb());f=1E3;for(d=0;10>d;d++)a.R(a.H.W(7,7,f+2E3*h.e(),3.4,30,32,52,150),[12E3*h.o(d/10*h.PI*2),-50,12E3*h.l(d/10*h.PI*2)],[0,0,0],0,"bumpmap",g,a.ka).J=l([1,.8,.52]);for(d=0;200>d;d++)a.Bc();a.nb=a.R(a.H.W(200,200,5E3,3.4,30,32,52,2E3),[5E3,-200,5E3],[0,0,0],
0,"bumpmap",g,a.ka);a.nb.J=l([.3,.2,.12]);a.Xb=a.j.K(120,20,10);g=new ra(this,a.O.bb(800,0,.08),"water",a.Xb,a.j.ba(1,a.n.M,130,125),a.j.Na(225,20,10));r([7400,1150,7300],g.position);a.d.push(g);f=1;a.i=new ra(this,a.O.ta(f,f,f,.5,.5),"unlit",a.j.K(255,255,255));a.i.Y[1]=1;a.i.qa=!0;a.i.rb=a.i.$a=!1;a.i.ca=Infinity;a.d.push(a.i);for(d=0;85>d;d++)5>d?a.ib(-2500+5E3*h.e(),-2500+5E3*h.e()):a.Cc();a.ab=new ra(this,a.O.Za(1,1,.5),"bloom",a.eb);r([0,0,-50],a.ab.position);$.clearColor(.6,.95,1,1);$.enable($.DEPTH_TEST);
var k=this,g=document.getElementById("z");k.p&&(g.addEventListener("touchstart",function(){k.a.Ba({keyCode:k.a.oa});k.Ma=!0}),g.addEventListener("touchend",function(){k.a.Ca({keyCode:k.a.oa});k.Ma=!1}),g.style.display="block");window.addEventListener("keyup",function(a){k.a.Ca(a)},!1);window.addEventListener("keydown",function(a){k.a.Ba(a)},!1);document.body.addEventListener("mousedown",b);document.body.addEventListener("touchstart",b);a.p?document.body.addEventListener("touchend",c):document.body.addEventListener("mouseup",
c);a.p?document.body.addEventListener("touchmove",e,!1):document.body.addEventListener("mousemove",e,!1);a.Sa=!0;a.f("Where am I?",a.q,a.ec)};a.Ec=function(){a.Z(0,Infinity);a.Da=function(){a.c[0]+=100;a.c[2]+=100}};a.ec=function(){a.f("Oh yeah, the Jolly Rogier was hit by some volcano debris.",a.q,a.fc)};a.fc=function(){a.f("I should swim over to the island",a.q,a.Ec)};a.gc=function(){a.f("I'm safe for now, but I need to attract some attention. What I can use?",a.q)};a.hc=function(){a.m=a.nb.position;
a.ea=!1;a.Dc();a.f("Oh no. I think it's going to erupt again!",a.q)};a.Dc=function(){a.state=5;setTimeout(function(){for(var b=0;b<a.ma.length;b++)r([1E3*(-.5+h.o(h.e()*h.PI)),3E3*(-.5+h.e())+1500,1E3*(-.5+h.l(h.e()*h.PI))],a.ma[b].c),a.ma[b].D=!0,setTimeout(function(){document.getElementById("glcanvas").style.opacity=0},1E4)},3E3)};a.action=function(){var b=a.i.item;if(b){for(var c=0,e=null,f=null,d=0;d<a.d.length;d++){var n=a.d[d];if(n.D&&n!==b){var k=l(n.position),m=l(a.i.position);k[1]=m[1]=0;
k=ga(k,m);if(1E4>k)if(2===n.type){if(!e||e.F<n.F)e=n;c++}else 1===n.type&&(f=n)}}1===b.type?(e&&r(e.position,b.position),null!=f&&(5>c?a.f("I think i need more fuel.",a.q):(a.Da=function(){if(a.N){var b=a.N.scale[1];a.N.gb(b+1)}else a.N=a.hb(f,2)},a.state=2,a.Q=0,a.Z(0,5)))):2===b.type&&e?(b.F=h.e()*h.PI*2,r(e.position,b.position)):(b.c=K(a.i.position,a.g,l()),W(b.c,.2));b.Fa(null);a.i.item=null}else{b=null;c=Infinity;for(d=0;d<a.d.length;d++)a.d[d].D&&(k=ga(a.d[d].position,a.i.position),!b||c>k)&&
(b=a.d[d],c=k);b&&9E4>c&&(3===b.type?a.f("Ouch! Too hot!",a.q):(2===b.type?a.f("I wonder if that would burn?",a.q):1===b.type&&a.f("If I hit it on another one...",a.q),b.Fa(a.i),b.F=0,a.i.item=b))}};a.Zb=function(){document.body.uc=document.body.requestPointerLock||document.body.mozRequestPointerLock||document.body.webkitRequestPointerLock;a.Wa||document.body.uc()};a.cb=function(b,c){var e=l();K(a.m,a.g,e);X(e);var f=Y();Z(f);ka(f,b,c,f);var d=e[0],n=e[1],k=e[2];e[0]=f[0]*d+f[4]*n+f[8]*k+f[12];e[1]=
f[1]*d+f[5]*n+f[9]*k+f[13];e[2]=f[2]*d+f[6]*n+f[10]*k+f[14];a.m=l(a.g);H(a.m,e)};a.vc=function(b,c){var e=l(),f=l();K(a.m,a.g,e);X(e);aa(e,a.na,f);X(f);a.cb(-b/360,a.na);a.cb(-c/360,f)};a.f("Loading...");var f=this;setTimeout(function(){f.Vb()},1)}
function ta(){var a=this;a.V={};a.pa={};a.vb=37;a.Bb=38;a.xb=39;a.ub=40;a.zb=32;a.Qc=82;a.E=69;a.Ab=85;a.La=81;a.oa=87;a.sb=83;a.yb=65;a.tb=68;a.wb=77;a.dc=-1;a.T=function(f){var b=a.pa[f];delete a.pa[f];return b};a.C=function(f){return a.V[f]};a.Ba=function(f){a.V[f.keyCode]||(a.pa[f.keyCode]=!0);a.V[f.keyCode]=!0};a.Ca=function(f){a.V[f.keyCode]&&delete a.V[f.keyCode]}}
(function(){function a(){function a(){c.Sa&&c.update();requestAnimationFrame(a)}clearInterval(f);var c=new sa;requestAnimationFrame(a)}var f=setInterval(function(){"complete"==document.readyState&&a()},11)})();
